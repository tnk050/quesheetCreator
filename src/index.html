<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <script>
      // Prevent forms from submitting.
      function preventFormSubmit() {
        var forms = document.querySelectorAll('form');
        for (var i = 0; i < forms.length; i++) {
          forms[i].addEventListener('submit', function (event) {
            event.preventDefault();
          });
        }
      }

      window.addEventListener('load', preventFormSubmit);

      function handleFormSubmit(formObject) {
        google.script.run
          .withSuccessHandler(handleDownload)
          .processForm(formObject);
      }
      function handleDownload(data) {
        const ar = new Uint8Array(data);
        const blob = new Blob([ar.buffer], { type: 'text/csv' });
        const link = document.createElement("a");
        link.href = window.URL.createObjectURL(blob);
        link.appendChild(document.createTextNode("ダウンロード"));
        const container = document.getElementById("output");
        container.appendChild(link);
        alert('作成しました')
      }
    </script>
    <style>
      table {border-collapse: collapse;}
      td {border:1px solid #333;}
    </style>
  </head>
  <body>
    <h1>Quesheet creator (α版)</h1>
    <p>Ride with GPS のキューシートcsvをちょっといい感じにするやつ</p>
    これが    
    <table>
      <tr>
        <td>Type</td><td>Notes</td><td>Distance (km) From Start</td><td>Elevation (m)</td><td>Description</td><td>Edited</td>
      </tr>
      <tr>
        <td>Left</td><td>高橋（交差点） を左折して 中央通り/​府道139号 に入る (枚方/​阪急茨木市駅 の表示)</td><td>0.24</td><td>12.57</td><td></td><td>Edited</td>
      </tr>
    </table>
    </br>こうなる
    <table>
      <tr>
        <td>No.</td><td>ポイント</td><td>方角</td><td>道路</td><td>合計</td><td>備考</td><td>説明</td>
      </tr>
      <tr>
        <td>2</td><td>高橋</td><td>左折</td><td>府道139号</td><td>0.2</td><td>中央通り/​府道139号 に入る (枚方/​阪急茨木市駅 の表示)</td><td></td>
      </tr>
    </table>
<p>使い方</br>
ファイルを選択→csvを選ぶ→Submit→出てきたダウンロードをクリック
</p>
    <form id="myForm" onsubmit="handleFormSubmit(this)">
      <input name="myFile" type="file" />
      <input type="submit" value="Submit" />
    </form>
    <div id="output"></div>
  </body>
</html>
